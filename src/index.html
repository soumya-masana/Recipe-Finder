<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Finder</title>
  
  <!-- 1. Tailwind CSS for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. React libraries -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- 3. Babel to transpile JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Simple font import */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-900">
  
  <!-- 4. The HTML element where your React app will be mounted -->
  <div id="root"></div>

  <!-- 5. Your React code goes inside this script tag -->
  <script type="text/babel">
    const { useState, useCallback } = React;

    // --- Helper Components ---

    // Loading Spinner Component
    const Spinner = () => (
      <div className="flex justify-center items-center p-8">
        <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500"></div>
      </div>
    );

    // Recipe Card Component
    const RecipeCard = ({ recipe }) => (
      <div className="bg-gray-800 rounded-2xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 ease-in-out group">
        <img 
          src={recipe.strMealThumb} 
          alt={recipe.strMeal} 
          className="w-full h-48 object-cover"
          onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/600x400/1f2937/ffffff?text=Image+Not+Found'; }}
        />
        <div className="p-5">
          <h3 className="text-lg font-semibold text-white truncate group-hover:text-indigo-400 transition-colors duration-200" title={recipe.strMeal}>
            {recipe.strMeal}
          </h3>
        </div>
      </div>
    );

    // Main Application Component (removed "export default")
    function App() {
      const [ingredient, setIngredient] = useState('');
      const [recipes, setRecipes] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [searched, setSearched] = useState(false);

      // --- API Fetch Logic ---
      const fetchRecipes = useCallback(async () => {
        if (!ingredient.trim()) {
          setError('Please enter an ingredient to search.');
          return;
        }
        
        setLoading(true);
        setError(null);
        setSearched(true);
        setRecipes([]);

        try {
          // Using exponential backoff for retries
          let response = null;
          let delay = 1000;
          for (let i = 0; i < 3; i++) {
            response = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?i=${ingredient.trim()}`);
            if (response.ok) break;
            await new Promise(res => setTimeout(res, delay));
            delay *= 2;
          }

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();

          if (data.meals) {
            setRecipes(data.meals);
          } else {
            setRecipes([]); // No meals found
          }
        } catch (e) {
          console.error("Failed to fetch recipes:", e);
          setError('Sorry, we couldn\'t fetch recipes. Please try again later.');
        } finally {
          setLoading(false);
        }
      }, [ingredient]);
      
      const handleSearch = (e) => {
        e.preventDefault();
        fetchRecipes();
      };

      // --- Render Logic ---
      return (
        <div className="min-h-screen bg-gray-900 text-gray-200 font-sans p-4 sm:p-6 lg:p-8">
          <div className="max-w-7xl mx-auto">
            
            {/* Header */}
            <header className="text-center my-8">
              <h1 className="text-4xl sm:text-5xl font-bold text-white tracking-tight">
                Recipe Finder
              </h1>
              <p className="mt-4 text-lg text-gray-400 max-w-2xl mx-auto">
                What ingredient do you have on hand today?
              </p>
            </header>
            
            {/* Search Bar */}
            <form onSubmit={handleSearch} className="max-w-2xl mx-auto mb-12">
              <div className="flex flex-col sm:flex-row gap-4">
                <input
                  type="text"
                  value={ingredient}
                  onChange={(e) => setIngredient(e.target.value)}
                  placeholder="e.g., Chicken, Rice, Avocado..."
                  className="w-full px-5 py-3 text-lg bg-gray-800 text-white border-2 border-gray-700 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                />
                <button
                  type="submit"
                  disabled={loading}
                  className="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-full hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-colors duration-300 disabled:bg-gray-500 disabled:cursor-not-allowed shrink-0"
                >
                  {loading ? 'Searching...' : 'Find Recipes'}
                </button>
              </div>
            </form>

            {/* Content Area */}
            <main>
              {loading && <Spinner />}
              
              {error && <p className="text-center text-red-400 text-xl">{error}</p>}
              
              {!loading && !error && searched && recipes.length === 0 && (
                <div className="text-center text-gray-400 py-10">
                  <h2 className="text-2xl font-semibold mb-2">No Recipes Found</h2>
                  <p>We couldn't find any recipes with "{ingredient}". Try another ingredient!</p>
                </div>
              )}

              {!loading && !error && recipes.length > 0 && (
                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                  {recipes.map((recipe) => (
                    <RecipeCard key={recipe.idMeal} recipe={recipe} />
                  ))}
                </div>
              )}
              
              {!loading && !searched && (
                 <div className="text-center text-gray-500 py-10">
                    <p className="text-xl">Let's get cooking! Your next meal is just a search away.</p>
                 </div>
              )}
            </main>
          </div>
        </div>
      );
    }

    // --- 6. Render your App component to the 'root' div ---
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App />);

  </script>
</body>
</html>
